generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  fullName      String                  @unique
  phoneNumber   String
  role          Roles                   @default(Mahasiswa)
  email         String                  @unique
  password      String
  id            Int                     @id @default(autoincrement())
  description   String?
  jurusan       String?
  calendar      String?
  appointments  Appointment[]           @relation("CreatedAppointments")
  assignments   AppointmentAssignment[] @relation("UserAppointments")
  notifications Notification[]          @relation("UserNotifications")
}

model Appointment {
  id            Int                     @id @default(autoincrement())
  title         String
  description   String
  creatorId     Int
  availableDays Weekday[]
  timeRange     Json
  media         Media
  creator       User                    @relation("CreatedAppointments", fields: [creatorId], references: [id])
  assignments   AppointmentAssignment[] @relation("AppointmentAssignments")
}

model AppointmentAssignment {
  id            Int              @id @default(autoincrement())
  userId        Int
  appointmentId Int
  selectedDate  DateTime
  selectedTime  DateTime
  peopleCount   Int
  status        AssignmentStatus @default(Pending)
  duration      Duration         @default(ONE_HOUR)
  appointment   Appointment      @relation("AppointmentAssignments", fields: [appointmentId], references: [id])
  user          User             @relation("UserAppointments", fields: [userId], references: [id])
  notifications Notification[]   @relation("AssignmentNotifications")
}

model Material {
  id    Int    @id @default(autoincrement())
  link  String
  title String
}

model Notification {
  id                      Int                    @id @default(autoincrement())
  userId                  Int
  message                 String
  status                  NotificationStatus     @default(NEW)
  createdAt               DateTime               @default(now())
  appointmentAssignmentId Int?
  appointmentAssignment   AppointmentAssignment? @relation("AssignmentNotifications", fields: [appointmentAssignmentId], references: [id])
  user                    User                   @relation("UserNotifications", fields: [userId], references: [id])
}

enum Roles {
  Mahasiswa
  Tutor
  Admin
}

enum Weekday {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum Media {
  Online
  Offline
  Hybrid
}

enum AssignmentStatus {
  Pending
  Accepted
  Declined
}

enum NotificationStatus {
  NEW
  READ
}

enum Duration {
  ONE_HOUR
  ONE_AND_HALF
  TWO_HOURS
  TWO_AND_HALF
  THREE_HOURS
}
